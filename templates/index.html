<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Calculadora Round Robin</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .excel-table input {
            width: 80px;
            text-align: center;
        }
        .gantt-img {
            max-width: 100%;
            border: 1px solid #ccc;
        }
        .csv-table {
            margin-top: 20px;
        }
    </style>
</head>
<body class="bg-light">
<div class="container py-4">
    <h1 class="mb-4">Calculadora Round Robin</h1>
    <form id="processForm" method="post" action="/" autocomplete="off">
        <div class="mb-3">
            <label for="num_processes" class="form-label">Número de procesos:</label>
            <input type="number" id="num_processes" name="num_processes" min="1" max="10" value="4" class="form-control" style="width:120px;display:inline-block;">
            <label for="quantum" class="form-label ms-3">Quantum:</label>
            <input type="number" id="quantum" name="quantum" min="1" max="20" value="3" class="form-control" style="width:120px;display:inline-block;">
            <button type="button" class="btn btn-secondary ms-3" onclick="updateTable()">Actualizar tabla</button>
        </div>
        <div class="excel-table">
            <table class="table table-bordered align-middle" id="processTable">
                <thead class="table-light">
                <tr>
                    <th>PID</th>
                    <th>Tiempo de llegada</th>
                    <th>Tiempo de ejecución</th>
                </tr>
                </thead>
                <tbody id="tableBody">
                <!-- Rows will be inserted by JS -->
                </tbody>
            </table>
        </div>
        <button type="submit" class="btn btn-primary">Calcular</button>
    </form>

    {% if results %}
    <hr>
    <h3>Resultados</h3>
    <div class="mb-3">
        <strong>Quantum óptimo:</strong> {{ results.quantum_optimo }} (AWT = {{ results.awt_optimo }})
    </div>
    <div>
        <strong>Comparativa de Quantum y su AWT:</strong>
        <table class="table table-sm table-striped w-auto">
            <thead><tr><th>Quantum</th><th>AWT</th></tr></thead>
            <tbody>
            {% for q, awt in results.resultados_quantum %}
                <tr {% if q == results.quantum_optimo %}class="table-success"{% endif %}>
                    <td>{{ q }}</td><td>{{ awt }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div>
        <strong>Tabla de resultados:</strong>
        <table class="table table-bordered w-auto">
            <thead><tr><th>PID</th><th>CT</th><th>WT</th></tr></thead>
            <tbody>
            {% for r in results.resultados %}
                <tr><td>P{{ r.pid }}</td><td>{{ r.retorno }}</td><td>{{ r.espera }}</td></tr>
            {% endfor %}
            </tbody>
        </table>
        <div><strong>T. medio de CT (ACT):</strong> {{ results.act }}<br>
        <strong>T. medio de WT (AWT):</strong> {{ results.awt }}</div>
    </div>
    <div class="mt-4">
        <strong>Gantt Chart:</strong><br>
        <img src="{{ url_for('static', filename='gantt.png') }}" class="gantt-img" alt="Gantt Chart">
    </div>
    <div class="csv-table mt-4">
        <strong>CSV (Gantt como tabla):</strong>
        <table class="table table-bordered table-sm w-auto">
            <tbody>
            {% for row in results.csv_data %}
                <tr>
                {% for cell in row %}
                    <td>{{ cell }}</td>
                {% endfor %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>
<script>
function updateTable() {
    let n = parseInt(document.getElementById('num_processes').value);
    let tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';
    for (let i = 0; i < n; i++) {
        let row = `<tr>
            <td>P${i+1}</td>
            <td><input type="number" name="arrival_${i}" value="${i}" min="0" required></td>
            <td><input type="number" name="burst_${i}" value="3" min="1" required></td>
        </tr>`;
        tbody.innerHTML += row;
    }
}
document.addEventListener('DOMContentLoaded', updateTable);
</script>
</body>
</html>
